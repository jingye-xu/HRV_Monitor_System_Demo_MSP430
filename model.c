/*
 * model.c
 *
 *  Created on: 12/15/2021
 *      Author: jingye_lab_win
 */

#include "model.h"
#include <math.h>


//******************************************************************************
// HR variables & parameters ***************************************************
//******************************************************************************

const float HR_f_weight_1[16][1] = {{-0.191832},{0.333564},{0.919064},{-0.877376},{0.884227},{0.729242},{-0.095088},{0.942135},{-0.811159},{0.256684},{-0.761562},{-0.485931},{-0.535257},{-0.002266},{1.061635},{-0.081969}};
const float HR_f_bias_1[16] = {-0.526083,-0.092369,-0.734045,-0.561864,0.307699,-0.166798,-0.233734,0.135242,0.781878,0.265769,-0.206842,-0.295624,-0.711944,0.087654,0.364300,-0.179787};
const float HR_f_weight_2[32][16] = {{0.199577,0.205428,-0.157937,0.030367,0.122675,0.230269,-0.095596,0.230178,-0.198379,0.196515,0.148611,-0.069546,0.099767,-0.175420,0.077707,0.215753},{-0.075021,0.060572,-0.061467,-0.105786,-0.191915,0.037920,0.014469,-0.186634,-0.045663,0.105379,0.201939,0.112492,-0.079941,0.134510,0.029047,-0.115578},{0.184923,-0.074345,0.084103,-0.148223,-0.181299,0.163614,-0.054499,0.041128,0.085380,0.191197,0.058147,-0.181786,0.006911,-0.072477,-0.156399,0.155156},{0.101034,-0.034963,-0.153945,-0.054180,-0.010433,0.117178,0.200792,-0.036820,-0.115415,-0.229883,-0.122822,-0.154372,-0.187778,0.152461,0.090135,0.044073},{-0.184256,-0.111585,-0.122363,0.097033,-0.180023,-0.056951,0.150679,0.223519,0.026910,-0.068213,0.191507,0.017731,-0.095256,0.244650,0.090758,0.114625},{0.109702,0.127860,0.076043,0.165732,0.216899,-0.158392,0.169105,-0.248288,-0.036696,0.233666,-0.239168,-0.102745,-0.061773,-0.171559,-0.041117,-0.198783},{0.012560,-0.144611,0.247684,0.115046,-0.141699,0.090100,-0.175616,0.267898,-0.198778,0.251404,-0.161197,0.152524,0.176114,-0.185108,-0.103055,0.155768},{0.203228,-0.203321,-0.022899,-0.112651,-0.207685,-0.157128,-0.120555,0.197735,0.087820,0.241807,0.103299,-0.231768,0.235732,-0.207666,-0.088669,0.056762},{0.059605,0.215921,-0.147492,-0.028899,-0.030672,-0.169372,0.197214,0.130132,0.073656,-0.057186,-0.096342,0.099802,0.185445,-0.201216,0.051250,-0.247534},{0.144071,0.055680,-0.011239,-0.085346,-0.088183,-0.175946,0.116821,-0.061162,0.087613,-0.206694,0.213819,-0.076311,0.131675,0.166281,0.134322,0.227934},{0.232107,0.312665,-0.076234,0.104984,0.321195,0.169057,-0.240822,0.252680,-0.105718,0.139424,0.207073,-0.130812,0.124330,-0.209419,0.236861,0.211093},{0.073006,0.207345,0.013284,0.066455,0.007545,0.233237,0.161757,-0.191699,0.103552,0.238997,0.068036,0.205069,0.086168,-0.167025,-0.137643,0.157622},{0.105669,-0.152657,0.135094,0.223771,-0.033866,-0.212926,0.037760,0.012996,0.157923,0.194646,-0.138887,0.170509,0.083022,-0.112482,-0.035458,0.236763},{0.120966,0.062884,0.299522,-0.027276,0.319454,0.353446,0.112731,0.120958,-0.003779,0.042476,-0.069944,0.247444,0.221846,-0.011463,0.160606,-0.223503},{-0.169833,0.146280,0.123563,0.055687,0.214189,-0.085410,-0.122438,0.138757,-0.100796,0.174615,-0.017408,0.075840,-0.144260,0.258200,0.184839,0.240011},{0.216405,0.071485,0.093163,-0.199556,0.247883,-0.083773,-0.051222,0.121029,-0.141732,0.188339,0.164936,-0.040932,-0.187061,0.007154,0.059513,0.239549},{0.180714,0.008643,-0.145353,-0.055583,-0.194748,-0.190174,-0.013003,0.234070,0.162124,-0.125216,-0.246757,-0.210988,-0.226109,-0.242691,0.183709,0.047364},{0.028329,-0.155892,0.071509,-0.040336,-0.178600,-0.249494,-0.162704,0.111962,0.148450,0.071422,-0.005110,0.137479,-0.181005,0.173746,-0.175069,0.164099},{0.026426,-0.177359,0.029221,-0.244808,-0.102381,-0.104786,0.002947,-0.147888,0.135663,0.047322,-0.130327,0.213428,-0.128044,-0.121525,0.111592,-0.192812},{0.115435,0.163775,-0.049028,-0.012437,-0.026142,-0.187476,0.067718,0.206038,-0.089625,-0.014727,-0.108959,0.063154,-0.209863,0.156237,-0.042228,-0.057766},{0.006840,-0.135885,0.121908,0.058735,-0.120830,-0.156475,0.172298,0.233953,-0.066996,0.178094,-0.041720,0.028339,-0.078675,0.154768,-0.136105,0.180390},{-0.117328,0.010682,-0.187203,-0.055188,0.017377,0.013510,-0.187111,-0.092852,0.136128,-0.004710,0.022240,-0.244601,-0.227191,-0.097139,0.003812,-0.179056},{0.065977,0.111764,-0.137846,-0.183084,0.228106,0.048867,-0.118353,0.018183,-0.025535,-0.084969,0.203473,-0.183226,-0.163103,0.142848,-0.233267,-0.106813},{-0.030654,0.139567,0.339862,-0.025156,-0.119906,-0.056778,-0.002695,0.043154,0.124277,0.251059,-0.205236,0.172667,-0.190218,0.016558,0.320085,0.234812},{-0.042139,0.264607,0.036528,-0.159119,0.311440,0.167618,-0.045870,0.148492,0.067331,-0.060605,0.082644,-0.059727,0.033511,-0.161982,0.111702,0.086300},{-0.012986,0.351471,0.261524,-0.192972,0.093923,0.073621,-0.229868,0.250612,0.105107,0.303581,-0.192250,-0.244417,0.053572,-0.181876,0.176780,0.030669},{-0.070175,0.036240,0.052626,0.207840,-0.155122,-0.184031,-0.108173,-0.178277,0.121519,-0.100402,-0.042732,-0.194087,0.001164,-0.075392,0.085175,-0.107270},{0.129401,0.038034,0.091471,-0.090600,0.263263,0.357869,0.155901,0.288050,0.186173,0.003228,-0.021251,0.237143,-0.075185,0.107236,0.136324,0.205986},{0.138150,0.219344,0.073088,0.167348,-0.050579,-0.031565,0.158830,-0.153104,0.002575,-0.128612,-0.054478,-0.145008,0.118977,0.004974,-0.154538,-0.147444},{-0.100161,-0.205920,-0.172828,0.147544,-0.202661,-0.208382,-0.141203,-0.244017,-0.026046,0.154507,0.159475,0.008185,-0.015063,0.058161,-0.007268,-0.115501},{-0.104235,-0.150414,0.095933,-0.040907,0.126719,-0.185069,-0.175332,-0.005704,0.028589,-0.235629,0.099293,0.124843,-0.080281,-0.118759,-0.103942,0.193727},{-0.100272,-0.184076,0.249835,-0.163292,-0.192460,-0.158323,0.175552,-0.207325,-0.032141,0.099494,0.078906,0.083863,0.034739,-0.017920,-0.142409,0.016549}};
const float HR_f_bias_2[32] = {0.008147,0.101297,0.217389,-0.011508,-0.087738,-0.218504,0.252263,0.033499,0.246919,0.173357,0.077784,-0.005270,0.153330,0.090293,0.200829,-0.046033,0.189253,0.013021,-0.070440,0.222059,-0.158530,0.210523,-0.234050,0.024125,0.121994,0.124488,-0.052396,0.090008,0.028038,-0.074208,0.089016,0.119920};
const float HR_f_weight_3[16][32] ={{-0.120031,-0.062769,-0.088127,-0.080815,0.089194,-0.033784,0.132895,0.152689,-0.117832,0.093539,0.063590,0.011309,-0.064556,-0.154714,-0.028498,0.116722,0.126928,0.163564,-0.105792,0.001002,-0.127561,-0.075756,0.118219,-0.108278,0.063199,0.152309,-0.140421,-0.099208,0.106208,0.154842,0.066435,0.085807},{0.142816,0.001316,-0.031614,0.123160,-0.017425,0.047553,0.150057,-0.112736,0.145559,0.029691,0.155873,0.151765,-0.121499,0.109860,0.154703,0.081659,0.116554,-0.084619,0.110240,-0.058343,0.122831,0.148216,0.171435,0.060935,0.235564,0.236941,0.063525,0.150268,-0.109669,-0.167919,0.066770,-0.032170},{-0.006213,-0.174482,-0.015464,-0.060649,0.106240,0.094916,-0.121585,0.167918,-0.054788,0.079312,-0.122473,-0.139080,-0.159491,-0.025504,0.019689,-0.084716,-0.118455,-0.108696,-0.077921,0.108778,0.080384,0.040251,-0.052657,0.115064,-0.024420,0.000944,-0.078268,-0.152021,-0.016373,-0.037767,-0.105738,-0.115992},{0.149142,0.044620,-0.062194,0.064170,-0.080279,-0.086738,-0.104946,-0.071721,-0.103056,0.069172,0.148911,-0.037390,-0.146387,0.004060,0.227560,0.196409,0.122305,0.157732,0.168186,0.009237,0.156808,-0.007989,0.048181,0.074378,-0.015245,0.024945,0.061991,0.229019,0.090179,0.163826,0.062048,-0.111049},{0.066429,0.072957,-0.069910,-0.109625,0.055680,0.007140,0.051970,-0.053074,-0.101366,-0.153148,0.248392,-0.114971,-0.089474,0.259395,0.166967,0.157753,0.009831,-0.049283,0.162393,-0.157506,0.016091,0.067991,-0.102956,0.169353,0.249292,0.097519,-0.163782,0.041897,0.017200,0.112042,-0.081751,-0.090867},{-0.172602,0.164622,-0.126911,-0.172908,0.143975,-0.111221,-0.036942,-0.014681,-0.039038,-0.018095,-0.102677,-0.020465,0.149740,-0.054523,-0.157873,-0.051572,-0.028102,0.116221,-0.010837,-0.130720,0.042475,0.108214,-0.110481,-0.098939,-0.077223,0.054972,-0.096324,0.023852,-0.116182,-0.027520,0.103527,0.093965},{-0.127572,-0.063925,0.012403,-0.078025,-0.001355,0.089666,0.101368,-0.128030,0.153544,-0.042867,0.029127,0.075997,0.108599,-0.170734,-0.090126,0.164078,0.078153,0.066319,-0.037605,-0.103656,0.009735,0.116269,-0.022643,0.019763,0.060824,0.124228,-0.174293,-0.159792,0.022074,0.125792,0.124093,0.106879},{0.104599,0.046517,0.030995,0.017818,0.073255,-0.054856,0.057681,-0.019494,-0.070716,0.061826,0.173383,-0.106676,0.106130,0.088350,0.038852,0.104205,0.037570,-0.008314,0.054608,-0.011903,-0.020956,0.135349,-0.013830,0.282713,0.184738,0.072730,-0.103009,0.203833,0.132476,0.023034,-0.095039,0.130925},{0.014587,-0.068555,-0.099970,-0.075608,0.109082,-0.019738,0.057079,0.096701,-0.075359,0.174177,-0.146245,0.126074,0.081081,-0.098079,0.093909,0.061406,-0.097220,-0.124688,-0.170245,-0.107495,0.019444,0.104596,-0.144179,-0.001073,0.002707,0.111591,0.117580,0.019098,0.083428,0.041962,-0.118934,0.123808},{0.234828,0.171223,0.076989,0.150532,-0.000016,0.092188,0.040645,0.143448,-0.132635,0.168007,0.058025,-0.002250,0.016380,0.058798,0.226328,-0.047996,0.168085,-0.041914,0.013742,-0.024321,-0.038727,-0.041846,0.100289,0.247428,0.076234,0.292552,0.035181,0.170063,0.145778,0.006697,0.095233,-0.155926},{-0.015217,-0.126015,0.174021,-0.076107,-0.133141,0.151123,-0.120057,-0.108469,-0.085866,-0.022305,-0.050072,-0.156164,0.110872,0.126285,-0.078337,-0.031662,-0.005736,0.015059,-0.114243,0.168805,0.135411,0.025076,-0.028285,0.009354,-0.118075,0.025818,-0.075018,-0.104331,0.060680,-0.041411,-0.083399,0.134709},{0.112574,-0.157614,0.017201,0.040827,-0.035476,-0.053029,0.022634,0.151014,-0.109577,0.126530,0.156351,-0.047519,0.073268,-0.149451,-0.148589,-0.042352,0.158583,-0.009357,-0.137269,0.121572,0.151608,0.127344,0.017653,0.023121,0.038843,-0.056860,-0.142073,-0.034294,0.049516,0.113687,-0.060874,0.023321},{0.017239,0.054196,0.019489,-0.031609,0.165200,0.056032,0.176172,0.126508,0.006751,-0.021479,0.029385,0.089537,0.099560,0.025449,0.108978,-0.108624,0.162997,0.136472,-0.008713,-0.105446,-0.059132,0.106386,0.083034,-0.126949,0.121495,-0.104661,0.093391,-0.165029,0.129092,-0.135490,-0.135264,0.017367},{-0.147395,-0.016381,0.059850,0.073269,0.016272,0.023024,-0.183924,0.013349,0.056320,0.000389,0.114448,-0.014412,0.014551,0.140033,-0.154377,0.097861,-0.098487,0.108732,0.017459,0.001397,-0.131985,0.167074,-0.158594,0.147619,-0.060181,-0.102515,0.159024,-0.138824,-0.048478,0.165250,-0.044709,-0.081592},{0.004610,-0.022920,0.091828,0.157290,0.039748,0.142397,0.193211,0.087117,0.166675,0.064595,0.023256,-0.087835,-0.155532,0.179976,0.207580,-0.044300,-0.080614,-0.172797,-0.060497,-0.145607,0.140583,-0.125427,0.097206,0.262025,0.138575,0.197503,-0.037438,0.159969,-0.115132,-0.151717,0.018438,-0.028777},{0.085690,0.045278,0.167328,-0.156054,0.067588,-0.075848,-0.077473,0.084175,-0.081348,-0.003086,0.234928,0.034186,-0.127203,0.123267,0.068218,0.063009,0.125203,0.165645,-0.025224,-0.116530,0.051139,0.009317,0.162996,0.228677,0.263503,0.050493,-0.155430,0.009318,-0.122918,-0.124632,-0.138967,0.092820}};
const float HR_f_bias_3[16] = {0.030274,0.110208,0.120519,0.007002,0.205797,-0.173960,-0.012818,0.220998,0.052795,0.182470,0.082153,0.078021,0.156625,-0.093101,-0.043346,0.136934};
const float HR_f_weight_4[8][16] = {{-0.226692,0.153513,0.025837,0.104626,-0.032801,-0.020121,-0.009864,-0.156002,-0.068440,0.100994,0.231950,-0.194529,-0.103942,-0.059155,-0.245693,0.105293},{-0.073095,-0.049923,0.092337,0.166645,-0.023261,-0.112386,0.192929,-0.092118,-0.211623,0.052890,-0.163742,0.200901,-0.080636,0.218653,-0.010522,0.009508},{0.230048,-0.060901,-0.231145,-0.002518,-0.185065,-0.134464,0.205997,-0.017263,-0.232659,0.123291,0.123792,0.139135,0.012606,0.054725,-0.244512,-0.021689},{-0.057381,-0.072419,-0.151993,0.063287,-0.250551,-0.048826,0.020383,0.203567,-0.045900,-0.148282,-0.174731,0.237815,0.139524,0.179615,0.144145,0.160889},{0.218036,-0.163132,-0.239271,0.035355,0.152268,0.028119,0.160963,-0.129573,0.080396,-0.010257,0.141755,-0.245182,-0.046140,0.187493,-0.016930,0.155178},{0.187319,0.010892,-0.140011,0.170994,-0.031093,-0.162359,0.086699,-0.298703,-0.170901,0.083446,0.023167,-0.098591,0.062672,-0.171202,0.045898,0.076943},{-0.021697,0.295386,0.065639,0.244380,0.267643,-0.016239,-0.232114,0.193660,-0.175990,0.300682,-0.249607,0.037442,-0.081010,-0.221558,0.306913,0.296730},{0.097942,-0.028639,-0.143721,0.177284,0.019959,-0.001058,-0.076730,-0.130686,-0.250178,-0.180954,-0.236096,0.132310,0.246052,0.089424,-0.054199,-0.098502}};
const float HR_f_bias_4[8] = {0.006127,0.177860,0.166361,0.074902,0.128714,0.046039,0.240012,-0.176906};
const float HR_f_weight_output[1][8] = {{-0.067600,-0.271176,-0.070647,-0.201218,-0.069333,-0.215681,0.491343,-0.319315}};
const float HR_f_bias_output[1] = {-0.041796};

float HR_f_l1[16] = {0};
float HR_f_l2[32] = {0};
float HR_f_l3[16] = {0};
float HR_f_l4[8] = {0};


//******************************************************************************
// HRV variables & parameters **************************************************
//******************************************************************************

const float HRV_f_weight_1[HRV_L1][HRV_COUNT + 1] = {{0.060358,-0.010670,-0.060226,0.039263,-0.004763,-0.068895,0.016528,0.034666,0.061069,-0.020408,0.035187,0.037482,0.043418,0.005929,-0.046137,0.062915,-0.068324,0.060818,0.002197,-0.052292,0.001745,-0.010930,-0.052131,0.021996,0.065496,0.003105,0.067962,0.056729,0.035979,0.049326,-0.054987,-0.084798,-0.050022,-0.036279,-0.000596,-0.060222,-0.020117,0.011031,-0.074833,0.063650,0.013199,0.033279,0.065942,-0.052066,0.024370,-0.043081,0.046687,0.025934,0.067562,-0.087524,-0.081540,-0.026501,-0.059884,-0.090688,0.056876,-0.040374,0.007973,-0.069869,-0.072573,-0.001882,-0.073234,-0.008185,-0.044935,-0.042073,0.039076,0.012276,0.002179,0.080403,-0.042871,-0.086719,0.029514,0.017227,-0.044109,0.030827,0.075222,0.067947,-0.002439,0.043053,-0.073377,-0.073176,-0.051846,-0.062796,-0.083781,-0.060110,-0.033075,0.074680,0.041573,-0.042164,-0.010739,-0.042991,-0.051079,-0.022521,0.055874,-0.021150,0.033822,-0.041440,-0.063039,0.089010,0.086511,0.039445,0.005141,-0.078234,-0.051981,0.002830,0.006838,-0.086803,-0.063496,-0.009583,-0.040894,-0.055776,-0.000256,-0.007727,-0.050064,-0.059051,-0.019292,-0.081754,-0.088560,0.082604,-0.023134,-0.000915,0.027274},{-0.019805,-0.077494,-0.017091,0.006941,0.066964,-0.069385,0.070441,-0.049743,-0.017574,0.062588,0.057959,-0.023846,0.030919,0.088562,-0.081493,0.087086,-0.072096,-0.001715,-0.022967,-0.004354,0.035581,0.077082,-0.013898,-0.017368,-0.029908,-0.033341,0.035101,-0.088501,0.055688,-0.029989,0.027116,0.031420,0.085476,0.088714,-0.081709,-0.074135,0.082132,0.041034,0.076419,0.030353,0.064796,0.022818,-0.081108,-0.027853,0.028170,-0.042971,0.054835,0.022434,-0.016407,-0.058038,0.024217,-0.060418,0.076035,0.056679,0.047625,0.006474,-0.016933,0.080695,-0.019622,0.077129,-0.034972,-0.016165,-0.006722,-0.081890,-0.062351,-0.006908,-0.082412,-0.016290,-0.044519,-0.090557,-0.086310,-0.086574,-0.080597,-0.051744,-0.082934,-0.064448,-0.052333,-0.066650,0.030815,0.064523,-0.011023,-0.080961,-0.029642,-0.058593,0.059772,-0.000068,0.080689,0.027941,0.026899,0.076429,0.064727,0.081564,-0.050120,0.007164,0.023812,-0.067943,0.046756,0.038024,0.012808,-0.022280,0.007097,-0.058371,0.045847,-0.091118,0.033291,0.010118,0.058893,-0.077735,-0.086259,0.053729,0.008138,0.037205,-0.086416,-0.051264,0.032244,-0.023765,0.074947,0.042340,-0.059217,0.070761,0.013986},{0.014383,0.081807,-0.025821,0.061629,0.043965,0.000380,0.084194,-0.077475,0.044595,0.085588,0.015478,0.047390,-0.001581,0.094533,0.030769,0.057010,-0.018897,0.053305,0.025438,0.049278,0.071859,0.066878,0.026917,0.051099,0.001130,-0.031435,0.051075,0.053974,-0.027794,-0.030304,0.088732,0.021919,0.072492,0.028896,0.089259,0.056037,0.092074,0.018277,0.029584,-0.010760,0.004831,0.094240,0.075365,0.080240,0.085444,-0.029004,0.016842,-0.079221,0.041578,0.022160,0.001038,0.061359,-0.025706,-0.058789,-0.058530,-0.024887,-0.044480,-0.010500,0.030586,-0.014280,0.079988,-0.031015,-0.024510,-0.078966,-0.059418,-0.052647,0.006284,-0.030462,-0.036573,0.028259,-0.005652,-0.079100,-0.056694,0.028424,-0.057928,0.053809,0.090371,0.083780,0.076187,-0.064070,0.096743,-0.058291,-0.015966,-0.038397,0.020111,-0.013758,0.039367,0.051229,0.019097,-0.041651,-0.079188,-0.015731,0.093301,-0.073981,0.047993,-0.040454,0.085724,-0.068352,0.044789,0.037909,0.090242,-0.055749,0.078396,0.015731,-0.051519,0.040339,0.033960,0.036552,0.084741,0.029795,0.085383,0.077924,-0.026533,0.094764,0.026920,0.013405,0.092771,-0.053852,0.089995,0.043516,0.080716},{0.052862,0.046085,0.016817,-0.009623,0.056040,0.002815,0.039600,0.096866,0.102750,0.005180,0.002352,0.100958,-0.035403,0.036166,-0.057369,-0.000082,-0.075785,0.082056,-0.039070,0.027626,-0.035395,0.074814,-0.056430,0.009087,0.021375,0.072999,-0.032922,-0.033834,0.025508,-0.009469,0.094603,-0.011547,0.073425,-0.053171,0.044420,0.076920,0.049859,0.047966,0.010536,0.084912,0.098050,-0.015320,-0.031087,0.013360,0.051892,0.075940,0.059571,0.005624,-0.003016,0.037338,0.003987,0.090962,0.007429,0.071376,-0.051391,0.086499,-0.076826,0.011279,-0.025717,-0.068384,-0.038206,0.097819,0.023894,-0.041708,-0.011680,0.007759,-0.078262,0.080258,-0.014229,-0.041877,-0.057269,0.025346,0.051313,-0.077966,0.059470,-0.051311,0.005345,-0.046419,0.028746,-0.008411,-0.044407,0.046269,-0.068919,-0.008013,-0.013107,0.061624,0.039103,0.058894,0.049923,0.024555,-0.008400,-0.072307,-0.002571,-0.053973,0.047676,-0.008255,-0.001986,0.005028,-0.048211,-0.029436,0.014345,0.070895,0.032007,-0.026075,0.090832,0.067366,-0.008871,-0.023629,-0.052164,0.015006,-0.044578,-0.004327,0.075023,0.057351,-0.055300,0.080225,0.031648,0.049419,0.099976,-0.003743,0.268538},{-0.016608,0.014905,0.071524,0.056252,-0.083466,0.079973,0.038115,-0.046917,0.081229,-0.059270,-0.059987,-0.078198,-0.041117,0.017470,0.038326,0.021359,-0.072983,-0.001354,-0.079783,0.030513,0.035752,0.039684,-0.091343,0.079314,0.045503,0.020075,0.050426,-0.006564,0.015775,0.072484,0.083408,0.049673,-0.010868,0.061514,0.035299,0.005127,-0.026701,-0.013236,-0.040885,0.073861,-0.072642,0.008934,-0.030829,0.014030,-0.084071,0.039117,-0.058702,0.078980,0.048691,0.088005,0.048709,-0.077153,-0.045713,-0.070656,-0.007589,-0.031878,-0.052842,0.018257,0.023273,-0.056134,0.033044,0.065293,-0.017212,0.061208,-0.086494,0.057476,-0.011064,-0.011592,-0.044233,-0.008147,0.064789,0.065803,0.085325,-0.079292,-0.000627,-0.042401,0.026232,-0.071336,0.028102,-0.027927,-0.023964,-0.088504,-0.019684,-0.023361,0.005040,0.020966,-0.051949,-0.027423,0.002486,0.057463,0.032203,-0.024924,0.016951,-0.005562,-0.070587,-0.039024,-0.059624,-0.029151,-0.081745,0.012142,0.033265,0.038004,-0.012599,-0.004038,-0.007498,-0.036160,0.086388,-0.042186,-0.001278,0.035496,-0.067427,-0.089309,0.006706,-0.002645,0.073109,-0.023799,0.067395,0.022310,-0.087238,-0.035228,0.062338},{-0.079345,-0.079312,-0.033628,0.058326,-0.025843,0.039284,-0.051909,0.015246,-0.010537,-0.040261,-0.056141,-0.070555,-0.076641,0.063858,-0.033746,-0.031945,-0.063502,0.061483,-0.078593,-0.069851,-0.040936,0.084283,-0.032007,0.049360,-0.059735,0.025473,-0.026010,-0.004757,0.061204,-0.060751,-0.024933,0.011162,0.033571,-0.055766,0.070297,-0.077200,0.083463,0.045973,-0.063021,0.001693,-0.077938,-0.011399,0.021973,-0.064963,0.069627,0.072557,-0.032870,-0.023497,0.016771,0.057957,-0.051925,0.066798,-0.032020,0.068990,0.077076,-0.032464,-0.010787,-0.051161,0.033445,0.067099,-0.017606,-0.042998,-0.065811,0.071263,-0.053122,0.020744,-0.064320,0.080129,-0.025424,-0.064440,-0.016567,-0.077059,0.060842,-0.082450,0.017252,-0.063522,-0.044231,0.071493,0.055263,-0.025868,0.050815,0.052667,-0.066469,0.008748,-0.089895,0.007099,0.006019,-0.048593,-0.047729,-0.084774,0.000976,0.019907,0.005898,0.015614,0.089649,0.005936,0.050586,0.057779,-0.046421,-0.061842,0.072117,0.068872,-0.032976,-0.005608,0.067025,-0.014991,0.042244,0.089235,-0.068821,0.034350,0.089691,-0.075261,-0.075120,0.012930,0.059951,-0.077923,-0.083566,0.042394,0.021820,0.022949,-0.003705},{-0.011012,-0.009055,0.044726,-0.025447,0.093254,0.034199,0.067407,0.003850,0.068919,0.090136,-0.025222,-0.007957,0.028454,0.064877,0.055775,0.071233,-0.005885,0.043297,0.094957,0.021940,-0.061343,0.054054,-0.028684,-0.003377,0.015465,0.068557,0.009157,-0.082577,-0.074927,0.034153,0.072170,0.086005,-0.018526,-0.014401,0.058189,-0.043001,0.041882,-0.068099,-0.075569,-0.056751,0.033883,-0.012732,-0.015007,0.027930,0.022041,0.025839,0.085121,0.033532,-0.071727,0.062127,-0.021320,0.044168,0.094691,-0.031170,0.001571,0.076156,-0.059986,-0.051776,-0.048824,-0.023837,0.029575,0.012802,-0.025416,0.016475,-0.007631,-0.046824,0.023396,-0.029131,-0.035033,0.094845,0.045079,0.043112,0.022633,-0.064225,0.098509,-0.023719,0.032150,0.096076,-0.070105,-0.057091,0.083718,-0.011894,-0.031104,-0.014715,0.042663,0.030335,0.036660,-0.063255,0.029689,0.041540,0.019570,0.026222,-0.039809,-0.029244,0.101194,-0.032620,-0.013659,0.094464,0.023884,0.091266,0.041808,0.015034,-0.078170,0.026832,0.079911,0.040498,0.084087,0.032214,-0.070379,-0.026905,0.052899,0.082544,0.054633,0.068476,0.065786,0.087217,0.033324,0.092577,-0.024437,0.046961,0.229440},{0.026940,0.042144,0.006986,-0.058265,-0.069787,-0.077397,-0.065725,-0.067453,-0.003325,-0.054338,0.016338,0.082436,-0.022635,-0.056217,-0.061885,-0.023243,0.008545,0.066109,-0.038453,-0.030343,-0.048784,-0.015124,-0.022608,0.001264,0.008944,0.011627,-0.063103,-0.016479,-0.046743,0.052349,0.009595,-0.036536,0.035779,0.041218,0.076582,-0.016965,0.001020,-0.009514,0.054335,0.038764,0.084079,-0.009965,-0.031516,-0.067072,0.009790,0.071281,-0.091938,-0.013473,-0.011527,-0.045182,-0.043786,0.076668,-0.014507,0.083407,0.053417,-0.035412,0.017414,0.057381,-0.092002,0.022315,-0.051802,0.032117,0.068898,-0.027946,-0.009026,-0.048068,0.031685,-0.094631,-0.060554,-0.028908,-0.017867,0.035501,-0.029463,0.035468,-0.095082,0.050410,-0.036785,0.008694,0.016056,0.060703,-0.002607,0.014769,0.007924,0.055745,0.025807,-0.032338,-0.013517,0.084471,0.059210,0.084497,0.039380,0.004811,-0.031756,-0.030626,-0.007649,0.030303,0.066141,-0.056682,0.010322,0.010239,0.068643,-0.076907,0.075864,0.041379,0.033600,0.028515,0.084983,0.006646,-0.056295,-0.023409,-0.055776,0.071167,0.011936,-0.092902,-0.085565,-0.005526,0.013962,0.045203,-0.020959,-0.010607,0.001771},{-0.003690,0.067675,0.100161,0.005621,-0.015059,-0.040582,-0.055210,-0.075619,-0.020023,0.056637,-0.014104,0.047665,0.080963,0.097627,0.029695,-0.074989,0.066751,-0.043690,0.016144,0.082105,0.087054,0.056945,-0.051574,-0.033737,0.004762,0.075226,0.094944,0.060134,0.049666,0.036133,-0.069355,0.073238,0.095695,0.030226,-0.051611,-0.035377,0.089357,0.020720,-0.048444,-0.023956,-0.056390,-0.004033,0.039131,-0.037219,0.073163,-0.074573,0.011290,-0.003209,0.016082,0.003131,-0.001182,0.008061,-0.047398,0.063902,0.061121,0.040596,-0.062407,0.003849,-0.003281,-0.034088,0.028013,0.084708,-0.003954,-0.005028,-0.012365,0.018851,-0.054327,0.067777,-0.060271,0.045903,-0.015541,-0.023255,0.057972,0.045578,-0.039463,-0.010470,0.066292,0.039619,-0.018561,0.089869,-0.021205,-0.039987,-0.016171,0.034461,0.000601,-0.004194,0.094700,-0.031473,0.006868,-0.013228,0.039853,0.071686,0.090325,-0.064368,0.007371,0.099563,0.095146,0.089285,-0.065670,0.093900,0.060981,0.002253,0.085988,-0.066890,-0.044956,0.082780,0.026116,0.005963,-0.036117,0.081163,-0.032177,-0.068058,-0.016042,0.003113,-0.055452,0.032024,0.065259,-0.032716,0.058272,0.087850,0.256418},{0.038703,0.010844,-0.057587,0.062267,0.049953,-0.067866,0.051016,-0.074431,-0.043881,0.075953,0.051510,-0.028820,-0.010833,-0.016920,0.032387,-0.038748,0.016313,0.096653,0.019173,0.069019,0.063147,0.079433,0.022883,0.073043,0.036184,-0.037905,0.092959,0.087802,-0.053057,-0.010480,-0.050657,-0.062989,-0.008969,0.000957,0.017419,-0.052837,0.078857,0.082822,0.073967,0.082614,-0.041974,0.010861,0.043747,-0.032258,0.040373,-0.005202,0.026108,-0.006848,0.025910,-0.072087,0.090644,0.094757,0.000370,0.027209,0.063771,0.058073,0.038044,0.080012,-0.000359,-0.034260,0.039569,0.091561,0.091823,-0.008909,0.022477,0.091880,0.038572,0.077760,-0.063934,-0.062999,0.086093,0.025207,0.033092,0.042982,0.084776,-0.026739,-0.043696,0.100535,0.036365,0.008388,-0.035696,-0.029540,0.002796,0.031747,-0.062553,0.054511,-0.048943,0.087261,-0.007776,0.059268,-0.000298,0.039681,-0.052970,0.052153,-0.028105,0.010055,0.036606,-0.038959,-0.043192,-0.027011,0.056372,0.062722,-0.043181,0.034804,0.043222,-0.072147,0.080695,-0.031556,-0.032851,0.020705,0.039358,0.046421,0.042591,0.093820,-0.028568,0.015640,0.016647,0.005580,-0.002023,0.012814,0.255599}};
const float HRV_f_bias_1[HRV_L1] = {-0.021520,-0.063145,0.087000,0.010577,0.032675,0.086299,-0.006500,0.059017,0.051721,0.012215};
const float HRV_f_weight_2[HRV_L2][HRV_L1] = {{-0.294287,-0.186341,-0.229556,-0.000872,0.084500,-0.216611,-0.125303,0.316833,-0.203728,0.217157},{0.303252,0.162567,-0.036427,-0.023781,0.151231,-0.203033,-0.297363,0.159756,-0.135634,-0.201824},{0.127090,0.073516,0.208017,0.076021,-0.191657,-0.188788,-0.153574,0.122564,-0.023727,0.137777},{-0.240358,0.076654,-0.282473,-0.051453,-0.263843,0.288848,0.227285,-0.230228,0.173888,0.155011},{0.065407,-0.013437,0.113564,-0.305995,0.273258,0.134581,0.031991,0.009573,0.081046,-0.209380},{-0.227215,-0.235910,-0.245070,0.117757,-0.015437,-0.150753,-0.008047,0.175676,0.128584,0.027503},{0.200273,-0.122250,0.227113,0.215819,-0.267169,-0.010385,-0.011192,-0.180228,0.004359,-0.080106},{-0.307084,-0.231743,-0.289362,0.262689,-0.141000,0.209098,0.329461,-0.096756,0.323992,0.107955},{0.144591,-0.231851,0.096876,-0.069483,-0.141746,0.311706,-0.305087,0.218896,0.280686,-0.233700},{0.171284,0.050100,-0.121433,0.218294,-0.008754,-0.303696,-0.113085,0.154710,-0.059458,0.088301}};
const float HRV_f_bias_2[HRV_L2] = {-0.150082,0.307794,0.274231,-0.215781,-0.168309,-0.127239,-0.155832,0.147295,-0.071444,-0.213270};
const float HRV_f_weight_output[1][HRV_L2] = {{0.044318,-0.246473,0.102889,-0.062710,0.046373,-0.242999,0.097461,0.205754,0.020558,-0.269042}};
const float HRV_f_bias_output[1] = {-0.142500};

float HRV_f_l1[HRV_L1] = {0};
float HRV_f_l2[HRV_L2] = {0};


//******************************************************************************
// variables & parameters END **************************************************
//******************************************************************************


float relu_jingye(float x)
{
    return x*(x > 0);
}

void simple_dnn_jingye(float *input, int input_len, float *output, int output_len, float *weight, float *bias, int relu)
{
    int outter_i,inner_j;
    for (outter_i=0;outter_i<output_len;outter_i++)
    {
        output[outter_i] = 0;
        for(inner_j=0;inner_j<input_len;inner_j++)
        {
            output[outter_i] += weight[outter_i*input_len+inner_j]*input[inner_j];
        }
        output[outter_i] += bias[outter_i];
        if (relu==1)
        {
            output[outter_i] = relu_jingye(output[outter_i]);
        }
    }
}


void forwardHR(float *input, float *output)
{
    simple_dnn_jingye(input, 1, HR_f_l1, 16, HR_f_weight_1[0], HR_f_bias_1, 1);
    simple_dnn_jingye(HR_f_l1, 16, HR_f_l2, 32, HR_f_weight_2[0], HR_f_bias_2, 1);
    simple_dnn_jingye(HR_f_l2, 32, HR_f_l3, 16, HR_f_weight_3[0], HR_f_bias_3, 1);
    simple_dnn_jingye(HR_f_l3, 16, HR_f_l4, 8, HR_f_weight_4[0], HR_f_bias_4, 1);
    simple_dnn_jingye(HR_f_l4, 8, output, 1, HR_f_weight_output[0], HR_f_bias_output, 0);
}


void PredictHR(float *input, float *output, int batch_len)
{
    int batch_i;
    for(batch_i=0;batch_i<batch_len;batch_i++)
    {
        forwardHR(&input[batch_i],&output[batch_i]);
    }
}

void forwardHRV(float *input, float *output)
{
    simple_dnn_jingye(input, HRV_COUNT + 1, HRV_f_l1, HRV_L1, HRV_f_weight_1[0], HRV_f_bias_1, 1);
    simple_dnn_jingye(HRV_f_l1, HRV_L1, HRV_f_l2, HRV_L2, HRV_f_weight_2[0], HRV_f_bias_2, 1);
    simple_dnn_jingye(HRV_f_l2, HRV_L2, output, 1, HRV_f_weight_output[0], HRV_f_bias_output, 0);
}


void PredictHRV(float *input, float *output, int batch_len)
{
    int batch_i;
    for(batch_i=0;batch_i<batch_len;batch_i++)
    {
        float input_rmssd[HRV_COUNT + 1] = {0};
        calculateHRV(&input[batch_i], HRV_COUNT, &input_rmssd[batch_i]);
        forwardHRV(&input_rmssd[batch_i],&output[batch_i]);
    }
}

void calculateHRV(float *input, int length, float *output)
{

    float inter_value = 0.0;

    int k,i;

    for(i=0;i<length-1;i++)
    {
        inter_value += pow(60000/input[i] - 60000/input[i+1], 2);
    }

    for(k=0;k<length;k++)
    {
        output[k] = input[k];
    }
    output[HRV_COUNT] = sqrt(inter_value / (length-1));
}

void DTHRV(float *input, float *output, int batch_len)
{
    int batch_i;
    for(batch_i=0;batch_i<batch_len;batch_i++)
    {
        float input_rmssd[30 + 1] = {0};
        calculateHRV(&input[batch_i], 30, &input_rmssd[batch_i]);

        if (input_rmssd[30] <= 18.23)
        {
            if (DTMinMaxScaler(input_rmssd[17]) <= 0.276)
            {
                if (DTMinMaxScaler(input_rmssd[9]) <= 0.304) *output = 28.702;
                else *output = 24.27;
            }
            else
            {
                if (DTMinMaxScaler(input_rmssd[10]) <= 0.307) *output = 25.57;
                else *output = 22.338;
            }
        }
        else
        {
            if (DTMinMaxScaler(input_rmssd[29]) <= 0.279)
            {
                if (input_rmssd[30] <= 23.832) *output = 32.134;
                else *output = 35.094;
            }
            else
            {
                if (DTMinMaxScaler(input_rmssd[22]) <= 0.249) *output = 31.769;
                else *output = 27.694;
            }
        }
    }
}

float DTMinMaxScaler(float input)
{
    return (input - MINSCALER)/(MAXSCALER - MINSCALER);
}
